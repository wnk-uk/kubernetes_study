# Deployment
********************************

## 1. 디플로이먼트
- 애플리케이션을 다운 타입 없이 업데이트 가능하도록 도와주는 리소스
- 레플리카셋과 레플리케이션컨트롤러 상위에 배포되는 리소스

### 디플로이먼트 작성요령
- 포드의 metadata 부분과 spce 부분을 그대로 옮김
- Deployment의 spec.template에는 배포할 포드를 설정
- replicas에는 이 포드를 몇 개를 배포할지 명시
- label은 디폴로이먼트가 배포한 포드를 관리하는데 사용됨

## 2. 롤링 업데이트와 롤백
#### 1. 기존 모든 포드를 삭제 후 새로운 포드 생성  
- 잠깐의 다운타임 발생 


#### 2. 새로운 포드를 실행시키고 작업이 완료되면 오래된 포드를 삭제  
- 새 버전을 실행하는 동안 구 버전 포드와 연결  
- 서비스의 레이블셀렉터를 수정하여 간단하게 수정가능  

#### 3. 레플리케이션컨트롤러가 제공하는 롤링 업데이트
- 이전에는 kubectl을 사용해 스케일링을 사용하여 수동으로 롤링 업데이트 진행  
- 레플리케이션컨트롤러 또는 레플리카셋을 통제할 수 있는 시스템이 필요 (kubectl)  


#### 4. 디플로이먼트 업데이트 전략
- Rolling Update(default)
> 오래된 포드를 하나씩 제거하는 동시에 새로운 포드 추가  
> 요청을 처리할 수 있는 양은 그대로 유지  
> 반드시 이전 버전과 새 버전을 동시에 처리 가능하도록 설계한 경우에만 사용해야함

- Recreate
> 새 포드를 만들기 전에 이전 포드를 모두 삭제  
> 여러 버전을 동시에 실행 불가능  
> 잠깐의 다운 타임 존재

- 업데이트 과정을 보기 위해 업데이트 속도 조절
> kubectl patch deployment http-go -p '{"spec": {"minReadySeconds": 10}}'

- 히스토리에 기록  
> kubectl create -f http-go --record=true 
- 업데이트한 이력을 확인
> kubectl rollout history deployment http-go


********************************